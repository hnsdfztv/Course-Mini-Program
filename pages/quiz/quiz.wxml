<!--pages/quiz/quiz.wxml-->
<view class="container">
  <!-- æœªå¼€å§‹æµ‹éªŒ -->
  <view class="quiz-intro" wx:if="{{!quizStarted}}">
    <view class="intro-icon">âœï¸</view>
    <view class="intro-title">å¯¹å¤–å¼€æ”¾çŸ¥è¯†æµ‹éªŒ</view>
    <view class="intro-subtitle">Knowledge Quiz</view>
    
    <view class="quiz-info">
      <view class="info-item">
        <view class="info-icon">ğŸ“</view>
        <view class="info-content">
          <view class="info-label">é¢˜ç›®æ•°é‡</view>
          <view class="info-value">{{totalQuestions}}é¢˜</view>
        </view>
      </view>
      <view class="info-item">
        <view class="info-icon">ğŸ“š</view>
        <view class="info-content">
          <view class="info-label">é¢˜åº“æ€»é‡</view>
          <view class="info-value">{{allQuestions.length}}é¢˜</view>
        </view>
      </view>
      <view class="info-item">
        <view class="info-icon">â±ï¸</view>
        <view class="info-content">
          <view class="info-label">æµ‹éªŒæ—¶é•¿</view>
          <view class="info-value">15åˆ†é’Ÿ</view>
        </view>
      </view>
      <view class="info-item">
        <view class="info-icon">ğŸ¯</view>
        <view class="info-content">
          <view class="info-label">åŠæ ¼åˆ†æ•°</view>
          <view class="info-value">60åˆ†</view>
        </view>
      </view>
    </view>

    <view class="quiz-tips">
      <view class="tips-title">ğŸ“Œ æµ‹éªŒè¯´æ˜</view>
      <view class="tips-content">
        <view class="tip-item">â€¢ ç³»ç»Ÿå°†ä»{{allQuestions.length}}é“é¢˜ä¸­éšæœºæŠ½å–{{totalQuestions}}é¢˜</view>
        <view class="tip-item">â€¢ æ¯é¢˜5åˆ†ï¼Œæ»¡åˆ†100åˆ†</view>
        <view class="tip-item">â€¢ æµ‹éªŒæ—¶é•¿15åˆ†é’Ÿï¼Œè¶…æ—¶è‡ªåŠ¨æäº¤</view>
        <view class="tip-item">â€¢ å¯éšæ—¶æŸ¥çœ‹ç­”é¢˜æƒ…å†µ</view>
        <view class="tip-item">â€¢ æµ‹éªŒå®Œæˆåå¯æŸ¥çœ‹æ­£ç¡®ç­”æ¡ˆå’Œè§£æ</view>
      </view>
    </view>

    <button class="btn-start" bindtap="startQuiz">å¼€å§‹æµ‹éªŒ</button>
  </view>

  <!-- æµ‹éªŒè¿›è¡Œä¸­ -->
  <view class="quiz-content" wx:if="{{quizStarted && !quizCompleted}}">
    <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
    <view class="quiz-header">
      <view class="quiz-progress">
        <text class="progress-text">{{currentQuestion + 1}}/{{questions.length}}</text>
      </view>
      <view class="quiz-timer">
        <text class="timer-icon">â±ï¸</text>
        <text class="timer-text">{{Math.floor(timeLeft / 60)}}:{{timeLeft % 60 < 10 ? '0' : ''}}{{timeLeft % 60}}</text>
      </view>
    </view>

    <!-- è¿›åº¦æ¡ -->
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{(currentQuestion + 1) / questions.length * 100}}%"></view>
    </view>

    <!-- é¢˜ç›®å†…å®¹ -->
    <view class="question-card">
      <view class="question-number">ç¬¬ {{currentQuestion + 1}} é¢˜</view>
      <view class="question-text">{{questions[currentQuestion].question}}</view>
      
      <view class="options-list">
        <view 
          class="option-item {{userAnswers[currentQuestion] === index ? 'selected' : ''}}"
          wx:for="{{questions[currentQuestion].options}}"
          wx:key="index"
          bindtap="selectAnswer"
          data-answer="{{index}}">
          <view class="option-label">{{['A', 'B', 'C', 'D'][index]}}</view>
          <view class="option-text">{{item}}</view>
        </view>
      </view>
    </view>

    <!-- å¯¼èˆªæŒ‰é’® -->
    <view class="quiz-navigation">
      <button 
        class="nav-btn" 
        bindtap="prevQuestion"
        disabled="{{currentQuestion === 0}}">
        ä¸Šä¸€é¢˜
      </button>
      <button 
        class="nav-btn nav-btn-primary" 
        bindtap="nextQuestion"
        wx:if="{{currentQuestion < questions.length - 1}}">
        ä¸‹ä¸€é¢˜
      </button>
      <button 
        class="nav-btn nav-btn-submit" 
        bindtap="submitQuiz"
        wx:if="{{currentQuestion === questions.length - 1}}">
        æäº¤ç­”å·
      </button>
    </view>

    <!-- ç­”é¢˜å¡ -->
    <view class="answer-sheet">
      <view class="sheet-title">ç­”é¢˜å¡</view>
      <view class="sheet-grid">
        <view 
          class="sheet-item {{userAnswers[index] !== undefined ? 'answered' : ''}} {{currentQuestion === index ? 'current' : ''}}"
          wx:for="{{questions}}"
          wx:key="id"
          bindtap="nextQuestion"
          data-index="{{index}}">
          {{index + 1}}
        </view>
      </view>
    </view>
  </view>

  <!-- æµ‹éªŒå®Œæˆ -->
  <view class="quiz-result" wx:if="{{quizCompleted}}">
    <view class="result-header">
      <view class="result-icon" wx:if="{{score >= 80}}">ğŸ‰</view>
      <view class="result-icon" wx:if="{{score >= 60 && score < 80}}">ğŸ‘</view>
      <view class="result-icon" wx:if="{{score < 60}}">ğŸ’ª</view>
      
      <view class="result-title" wx:if="{{score >= 80}}">ä¼˜ç§€ï¼</view>
      <view class="result-title" wx:if="{{score >= 60 && score < 80}}">è‰¯å¥½ï¼</view>
      <view class="result-title" wx:if="{{score < 60}}">ç»§ç»­åŠªåŠ›ï¼</view>
    </view>

    <view class="result-score">
      <view class="score-label">æ‚¨çš„å¾—åˆ†</view>
      <view class="score-value">{{score}}</view>
      <view class="score-total">/ 100åˆ†</view>
    </view>

    <view class="result-stats">
      <view class="stat-item">
        <view class="stat-label">æ­£ç¡®é¢˜æ•°</view>
        <view class="stat-value">{{score / 10}}/{{questions.length}}</view>
      </view>
      <view class="stat-item">
        <view class="stat-label">ç”¨æ—¶</view>
        <view class="stat-value">{{Math.floor((600 - timeLeft) / 60)}}åˆ†{{(600 - timeLeft) % 60}}ç§’</view>
      </view>
      <view class="stat-item">
        <view class="stat-label">æ­£ç¡®ç‡</view>
        <view class="stat-value">{{score}}%</view>
      </view>
    </view>

    <!-- ç­”æ¡ˆè§£æ -->
    <view class="answer-analysis">
      <view class="analysis-title">ç­”æ¡ˆè§£æ</view>
      <view class="analysis-list">
        <view 
          class="analysis-item"
          wx:for="{{questions}}"
          wx:key="id">
          <view class="analysis-header">
            <view class="analysis-number">ç¬¬{{index + 1}}é¢˜</view>
            <view class="analysis-status {{userAnswers[index] === item.correctAnswer ? 'correct' : 'wrong'}}">
              {{userAnswers[index] === item.correctAnswer ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯'}}
            </view>
          </view>
          <view class="analysis-question">{{item.question}}</view>
          <view class="analysis-answer">
            <text class="answer-label">æ­£ç¡®ç­”æ¡ˆï¼š</text>
            <text class="answer-value">{{['A', 'B', 'C', 'D'][item.correctAnswer]}}</text>
          </view>
          <view class="analysis-your-answer" wx:if="{{userAnswers[index] !== item.correctAnswer}}">
            <text class="answer-label">æ‚¨çš„ç­”æ¡ˆï¼š</text>
            <text class="answer-value wrong">{{userAnswers[index] !== undefined ? ['A', 'B', 'C', 'D'][userAnswers[index]] : 'æœªä½œç­”'}}</text>
          </view>
          <view class="analysis-explanation">
            <text class="explanation-label">è§£æï¼š</text>
            <text class="explanation-text">{{item.explanation}}</text>
          </view>
        </view>
      </view>
    </view>

    <view class="result-actions">
      <button class="btn-retake" bindtap="retakeQuiz">é‡æ–°æµ‹éªŒ</button>
    </view>
  </view>
</view>
